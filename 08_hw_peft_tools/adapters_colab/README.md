# ะะฐะฑะพัะฐ ั LoRA-ะฐะดะฐะฟัะตัะฐะผะธ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะขะะะซ ะบะฐะบ ัะผะตะฝะฝัะต ะฝะฐัะฐะดะบะธ: ะพะดะฝะฐ ะฑะฐะทะฐ, ะผะฝะพะณะพ ัะตะถะธะผะพะฒ    โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโค
โ ะฏะบะพัั     โ ะะตัะฐะฝะธะบะฐ   โ ะัะพััะฒ     โ ะัะธะผะตะฝะตะฝะธะต           โ
โ 3 ัะตะบ     โ 20 ัะตะบ     โ โจ 5 ัะตะบ   โ 10 ัะตะบ               โ
โ ะกะผะตะฝะฝัะต   โ ะะฐะณััะทะบะฐ + โ set_adapterโ Merge ะดะปั ะดะตะฟะปะพั,    โ
โ ะฝะฐัะฐะดะบะธ   โ ะฟะตัะตะบะปััะตะฝะธะตโ            โ ัะพััะตั ะฟะพ ะฟัะพะผะฟัั   โ
โโโโโโโโโโโโโโดโโโโโโโโโโโโโดโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ ะฏะบะพัั + ัะผะพัะธะพะฝะฐะปัะฝัะน ะผะพััะธะบ

**๐ฏ ะฏะะะะฌ:** ะะดะฝะฐ ะฑะฐะทะพะฒะฐั ะผะพะดะตะปั โ Mistral-7B. ะะตัะบะพะปัะบะพ ยซะฝะฐัะฐะดะพะบยป: JSON, ะบะพะดะธะฝะณ, ะฟะพะดะดะตัะถะบะฐ. ะะตะฝัะตัั ะฝะฐัะฐะดะบั โ ะผะพะดะตะปั ัะฐะฑะพัะฐะตั ะฒ ะดััะณะพะผ ัะตะถะธะผะต.

๐ก **ะญะผะฟะฐัะธั:** ยซะะฒััะธั ะบะฐะบ ะฝะตัะบะพะปัะบะพ ะผะพะดะตะปะตะน? ะะดะฝะฐ ะฑะฐะทะฐ ะฒ ะฟะฐะผััะธ + ะฐะดะฐะฟัะตั ~50 MB โ ะฟะตัะตะบะปััะฐะตัั ะทะฐ ัะตะบัะฝะดั.ยป

---

## ๐ ะขะตัะผะธะฝั ะธ ะฟะพะฝััะธั

| ะขะตัะผะธะฝ | ะงัะพ ััะพ | ะะตัะฐัะพัะฐ |
|--------|---------|----------|
| **LoRA-ะฐะดะฐะฟัะตั** | ะคะฐะนะป ~50 MB. ะะฐะบะปะฐะดัะฒะฐะตะผ ะฝะฐ base. | ๐ง ะกะผะตะฝะฝะฐั ะฝะฐัะฐะดะบะฐ |
| **load_adapter** | ะะพะฑะฐะฒะธัั ะฐะดะฐะฟัะตั. `adapter_name` = ะธะผั. | ๐ ะัะธะบัะตะฟะธัั ะดะพะบัะผะตะฝั |
| **set_adapter** | ะะตัะตะบะปััะธัั ะฐะบัะธะฒะฝัะน. ยซjsonยป / ยซcodingยป. | ๐ ะะตัะตะบะปััะฐัะตะปั |
| **Merge** | ะัะธัั ะฒ base. ะะดะธะฝ ัะฐะนะป. ะะตัะตะบะปััะตะฝะธะต ะฝะตะดะพัััะฟะฝะพ. | ๐งต ะัะธัะธัั ะฝะฐะผะตััะฒะพ |
| **ะะพััะตั** | ะะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ โ ะฒัะฑะพั adapter. | ๐ฆ ะกะฒะตัะพัะพั |

---

## ๐ท ะัะพะณัะตััะธะฒะฝะฐั ััะตะผะฐ (3 ัะฐะทั)

#### ะคะฐะทะฐ 1: ะะฐะณััะทะบะฐ
```
โโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ
โ  Base        โ โโ  โ  + Adapter   โ PeftModel.from_pretrained
โ  Mistral-7B  โ     โ  lora_json   โ
โโโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโโ
```

#### ะคะฐะทะฐ 2: ะะตัะตะบะปััะตะฝะธะต
```
โโโโโโโโโโโโโโโโ
โ  load_adapterโ json, coding, support
โโโโโโโโฌโโโโโโโโ
       โ
โโโโโโโโโโโโโโโโ
โ set_adapter  โ model.set_adapter("json")
โโโโโโโโโโโโโโโโ
```

#### ะคะฐะทะฐ 3: ะัะพััะฒ โ โจ ะะะข ะะะะกะฌ ะะะะะฏ!
```
โโโโโโโโโโโโโโโโ
โ  ะะพััะตั      โ ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ โ adapter
โโโโโโโโฌโโโโโโโโ
       โ
โจ ยซjsonยป, ยซััะตะผยป โ json; ยซะบะพะดยป, ยซbugยป โ coding
   ะะฒัะพะผะฐัะธัะตัะบะธะน ะฒัะฑะพั ะฑะตะท ะทะฐะฟัะพัะฐ ะฟะพะปัะทะพะฒะฐัะตะปั
```

---

## ๐ ะขะฐะฑะปะธัะฐ ะบะพะฝััะฐััะพะฒ

| ะงัะพ ะดัะผะฐัั โ | ะงัะพ ะฝะฐ ัะฐะผะพะผ ะดะตะปะต โ | ะะธะทัะฐะปัะฝะฐั ะผะตัะฐัะพัะฐ |
|---------------|---------------------|----------------------|
| ยซะะดะธะฝ ะฐะดะฐะฟัะตั ะฝะฐ ะผะพะดะตะปัยป | load_adapter โ ะฝะตัะบะพะปัะบะพ, set_adapter โ ะฟะตัะตะบะปััะฐะตะผ | `ะกะผะตะฝะฝัะต ะฝะฐัะฐะดะบะธ` |
| ยซMerge = ะฟะพัะตััยป | Merge = ะพะดะธะฝ ัะฐะนะป ะฑะตะท PEFT ะดะปั ะดะตะฟะปะพั | `ะกะฑะพัะบะฐ ะบะพะฝััััะบัะพัะฐ` |
| ยซะะพััะตั = ัะปะพะถะฝะพยป | if "json" in text: return "json" | `ะกะฒะตัะพัะพั` |
| ยซDrive ะพะฑัะทะฐัะตะปะตะฝยป | ะะพะบะฐะปัะฝะพ, Drive ะธะปะธ Hugging Face Hub | `ะขัะธ ะฒะฐัะธะฐะฝัะฐ ััะฐะฝะตะฝะธั` |

---

## ๐ป ะะธะฝะธ-ะบะพะด ั ะบะพะผะผะตะฝัะฐัะธัะผะธ-ัััะตะปะบะฐะผะธ

```python
# โ 1. ะะฐะณััะทะบะฐ base + ะฐะดะฐะฟัะตัะพะฒ
base = AutoModelForCausalLM.from_pretrained(base_id, ...)
model = PeftModel.from_pretrained(base, "lora_json", adapter_name="json")
model.load_adapter("lora_coding", adapter_name="coding")
# โ 2. ะะตัะตะบะปััะตะฝะธะต
model.set_adapter("json")   # ัะตะถะธะผ JSON
model.set_adapter("coding") # ัะตะถะธะผ ะบะพะดะธะฝะณะฐ
#        โ
#        โโโโ โจ ะะะข ะะะะกะฌ ะะะะะฏ: ะพะดะฝะฐ ะผะพะดะตะปั, ัะฐะทะฝัะต ยซะปะธัะฝะพััะธยป
```

---

## โ ะงะตะบ-ะปะธัั ัะฐะผะพะฟัะพะฒะตัะบะธ

```
โ ะัะพะฒะตัั ัะตะฑั ะทะฐ 15 ัะตะบัะฝะด:
โซ๏ธ ะะพะณั ะพะฑัััะฝะธัั: base + adapter = ะพะดะธะฝ ัะตะถะธะผ
โซ๏ธ ะะฝะฐั load_adapter ะธ set_adapter
โซ๏ธ ะะพะฝะธะผะฐั merge: ะพะดะธะฝ ัะฐะนะป ะดะปั ะฟัะพะดะฐะบัะตะฝะฐ
โซ๏ธ ะะพะณั ะฝะฐะฟะธัะฐัั ัะพััะตั ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ
โซ๏ธ ะะฝะฐั, ะณะดะต ััะฐะฝะธัั: ัะตััะธั, Drive, Hub

โ ะัะปะธ 4+ ะณะฐะปะพัะบะธ โ ัะฒะตัะตะฝะฝะพ ะฒะปะฐะดะตะตัั ะพัะฝะพะฒะพะน.
```

---

## ๐ ะะธะบัะพ-ะฟัะพะฒะตัะบะฐ

**ะะพะฟัะพั:** set_adapter ะฝะต ะผะตะฝัะตั ะผะพะดะตะปั?  
**ะัะฒะตั:** ะะดะฐะฟัะตัั ะดะพะปะถะฝั ะฑััั ะพั ะพะดะฝะพะน base. ะัะพะฒะตัั adapter_name ะธ ะฟะพััะดะพะบ load_adapter.

**ะะพะฟัะพั:** Merge โ ะฟะพัะตัั ะณะธะฑะบะพััะธ?  
**ะัะฒะตั:** Merge = ะพะดะธะฝ ัะฐะนะป ะดะปั ะดะตะฟะปะพั ะฑะตะท PEFT. ะฅัะฐะฝะธ ะพัะดะตะปัะฝะพ ยซััััะตยป ะฐะดะฐะฟัะตัั ะดะปั ะฟะตัะตะบะปััะตะฝะธั.

---

## โ๏ธ ะงะฐัััะต ะพัะธะฑะบะธ

| ะัะธะฑะบะฐ | ะะตัะตะฝะธะต |
|--------|---------|
| `set_adapter` โ ะผะพะดะตะปั ะฝะต ะผะตะฝัะตััั | ะะดะฐะฟัะตัั ะดะพะปะถะฝั ะฑััั ะพั ะพะดะฝะพะน base; ะฟัะพะฒะตัั `adapter_name` |
| Merge โ ะผะพะดะตะปั ยซะทะฐะฑัะปะฐยป ะดััะณะธะต ะฐะดะฐะฟัะตัั | Merge = ะพะดะธะฝ ัะตะถะธะผ ะฝะฐะฒัะตะณะดะฐ; ััะฐะฝะธ ะพัะดะตะปัะฝะพ ะดะปั ะฟะตัะตะบะปััะตะฝะธั |

---

## โก๏ธ ะงัะพ ะดะฐะปััะต

- **02_merge_adapter** โ ะพะดะธะฝ ัะฐะนะป ะดะปั ะดะตะฟะปะพั ะฑะตะท PEFT.
- **03_router_demo** โ ะฐะฒัะพ-ะฒัะฑะพั ะฐะดะฐะฟัะตัะฐ ะฟะพ ะฟัะพะผะฟัั.

**โ30 ะผะธะฝ** โ ะฑะปะพะบะฝะพัั | **โ1 ั** โ ัะฒะพะน ัะพััะตั ะฟะพะด 2โ3 ััะตะฝะฐัะธั

---

## ๐ ะกัััะบัััะฐ ะฟะฐะฟะบะธ

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `01_load_switch_adapters.ipynb` | ะะฐะณััะทะบะฐ, ะฟะตัะตะบะปััะตะฝะธะต |
| `02_merge_adapter.ipynb` | Merge ะดะปั ะดะตะฟะปะพั |
| `03_router_demo.ipynb` | ะะพััะตั ะฟะพ ะฟัะพะผะฟัั |

---

## ะะดะฐะฟัะตัั (ะฟัะธะผะตั)

| ะะดะฐะฟัะตั | ะะฐะทะฝะฐัะตะฝะธะต |
|---------|------------|
| `lora_json` | JSON, ััััะบัััะธัะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต |
| `lora_coding` | ะะพะด, ัะตัะฐะบัะพัะธะฝะณ |
| `lora_support` | ะขะตัะฟะพะดะดะตัะถะบะฐ |

---

## Merge (ะฟัะพะดะฐะบัะตะฝ)

```python
merged = model.merge_and_unload()
merged.save_pretrained("mistral-7b-json-specialist")
# ะะฐะปััะต: AutoModelForCausalLM โ ะฑะตะท PEFT
```

---

## Colab: ะณะดะต ััะฐะฝะธัั

1. **ะกะตััะธั** โ ะฟัะพะฟะฐะดัั ะฟัะธ ัะฑัะพัะต
2. **Google Drive** โ `drive/MyDrive/adapters/`
3. **Hugging Face Hub** โ `push_to_hub`, `from_pretrained`
