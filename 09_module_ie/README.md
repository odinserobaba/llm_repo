# Модуль 9 — Information Extraction (NER, IE)

```
┌─────────────────────────────────────────────────────────────┐
│  IE как иголка из стога сена: сущности, связи, события     │
│  в неструктурированном тексте                               │
├────────────┬────────────┬────────────┬──────────────────────┤
│ Якорь     │ Механика   │ Прорыв     │ Применение           │
│ 3 сек     │ 20 сек     │ ✨ 5 сек   │ 10 сек               │
│ Маркер    │ NER → IE   │ LLM для    │ JSON, SQLite,        │
│ в тексте  │ relation   │ аннотации  │ BI-дашборды          │
└────────────┴────────────┴────────────┴──────────────────────┘
```

---

## 🎯 Якорь + эмоциональный мостик

**🎯 ЯКОРЬ:** Выделить имена, даты, организации в тексте маркером — как школьная пометка «здесь персона, здесь место». NER и IE делают то же автоматически: сущности и связи.

💡 **Эмпатия:** «Звучит как разбор полиграфа? Сейчас станет проще, чем поиск по документу Ctrl+F.»

---

## 📖 Термины и понятия

| Термин | Что это | Метафора |
|--------|---------|----------|
| **NER** | Распознавание имён: PERSON, ORG, LOC, DATE. | 🏷️ Маркер в тексте |
| **IE** | Сущности + связи + события. Шире NER. | 🕸️ Паутина связей |
| **Relation** | «Кто с кем»: (Иван, works_at, Яндекс). | 🔗 Ниточка между именами |
| **Event** | Что произошло, кто, когда, где. | 📅 Запись в дневнике |
| **spaCy** | NLP-библиотека. ru_core_news_sm, en_core_web_sm. | 🔧 Универсальный инструмент |
| **natasha** | Для русского. Медиа-текст. | 🇷🇺 Локализация |
| **Промпт-based IE** | LLM по промпту → JSON. Без переобучения. | 📝 Универсальный переводчик |

---

## 📐 Радиальная карта

```
                         ┌──────────────────┐
                         │   IE             │ ← ЦЕНТР
                         │   (Information   │
                         │   Extraction)    │
                         └────────┬─────────┘
              ┌───────────────────┼───────────────────┐
              ↓                   ↓                    ↓
       ┌────────────┐     ┌────────────┐     ┌────────────┐
       │ NER        │     │ IE         │     │ Storage    │
       │ (3 шт.)    │     │ (3 шт.)    │     │ (2 шт.)    │
       └─────┬──────┘     └─────┬──────┘     └─────┬──────┘
             ↓                   ↓                   ↓
       • spaCy            • Relation extract  • JSON, SQLite
       • natasha          • Event extract     • Графы, BI
       • Hugging Face     • LLM аннотация
```

---

## 🔷 Прогрессивная схема (3 фазы)

#### Фаза 1: NER
```
┌──────────────┐     ┌──────────────┐
│  Текст       │ ─→  │  NER-модель  │ spaCy / natasha / HF
└──────────────┘     └──────┬───────┘
                           ↓
                    ┌──────────────┐
                    │  PER, ORG,   │
                    │  LOC, DATE   │
                    └──────────────┘
```

#### Фаза 2: Relation / Event Extraction
```
┌──────────────┐     ┌──────────────┐
│  Текст       │ ─→  │  Relation    │ (Иван, works_at, Яндекс)
│  + сущности  │     │  Event       │ (встреча, кто, когда, где)
└──────────────┘     └──────────────┘
```

#### Фаза 3: Прорыв ← ✨ ВОТ ЗДЕСЬ МАГИЯ!
```
┌──────────────┐
│  LLM         │ промпт: «Извлеки отношения в JSON»
└──────┬───────┘
       ↓
✨ Без переобучения — новый домен через промпт
   Классические: отдельная модель под схему
```

---

## 📊 Таблица контрастов

| Что думают ❌ | Что на самом деле ✅ | Визуальная метафора |
|---------------|---------------------|----------------------|
| «NER = IE» | NER — сущности, IE — связи и события | `Словарь vs грамматика` |
| «LLM не для IE» | LLM гибко подстраивается под схему | `Универсальный переводчик` |
| «Только английский» | spaCy, natasha — русский | `Локализация` |
| «Чёрный ящик» | JSON → DataFrame → дашборд | `Конвейер данных` |

---

## 💻 Мини-код с комментариями-стрелками

```python
# ← 1. spaCy NER
nlp = spacy.load("ru_core_news_sm")
doc = nlp("Иван Петров из Яндекса встретился в Москве.")
# ← 2. Сущности
for ent in doc.ents: print(ent.text, ent.label_)
# ← 3. LLM для relation extraction
prompt = "Извлеки отношения. Текст: {text}"
#        ↑
#        └─── ✨ ВОТ ЗДЕСЬ МАГИЯ: новый домен = новый промпт
```

---

## ✅ Чек-лист самопроверки

```
✅ Проверь себя за 15 секунд:
▫️ Могу объяснить NER vs IE (сущности vs связи)
▫️ Знаю инструменты: spaCy, natasha, Hugging Face
▫️ Понимаю relation/event extraction
▫️ Вижу, зачем LLM для аннотации (гибкость схемы)
▫️ Могу сохранить в JSON/DataFrame и визуализировать

→ Если 4+ галочки — уверенно владеешь основой.
```

---

## 🔍 Микро-проверка

**Вопрос:** NER и IE — одно и то же?  
**Ответ:** Нет. NER = только сущности (слова). IE = сущности + связи между ними + события. Словарь vs грамматика.

**Вопрос:** Зачем LLM для IE, если есть spaCy?  
**Ответ:** spaCy — фиксированные типы. LLM по промпту подстраивается под новую схему (юриспруденция, медицина) без переобучения.

---

## ⚠️ Частые ошибки

| Ошибка | Решение |
|--------|---------|
| spaCy не находит русские сущности | `ru_core_news_sm` — для EN другая модель |
| LLM возвращает не JSON | Явно: «Output ONLY valid JSON», парсер по скобкам |

---

## ➡️ Что дальше

- **ДЗ 9** — IE из диалогов (WildChat, промпт-based).
- **Практика:** свой текст → spaCy + natasha, сравни результаты.

**≈45 мин** — блокноты | **≈1.5 ч** — свой документ в граф связей

---

## 📁 Блокноты

| Файл | Якорь | Что делаем |
|------|-------|------------|
| `01_ner_spacy_natasha_hf.ipynb` | Маркер в тексте | spaCy, natasha, HF NER |
| `02_information_extraction.ipynb` | Кто с кем связан | Relation, Event, LLM |
| `03_storage_visualization.ipynb` | Папки + дашборд | JSON, SQLite, графы |

---

**Попробуй:** открой `01_ner_spacy_natasha_hf.ipynb` и прогони один текст через spaCy и natasha.
