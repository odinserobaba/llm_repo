# Модуль 9 — Information Extraction (NER, IE): карта понимания

Это как вытащить иголку из стога сена: находим сущности, связи и события в неструктурированном тексте.

Здесь подробная карта модуля 9: что делаем и зачем.

---

## 1) Цели занятия

- **доставать важную информацию** из неструктурированных документов
- **знать методы NER и IE** (Named Entity Recognition, Information Extraction)
- **интегрировать результат** в приложения

---

## 2) Краткое содержание

1. **Information Extraction:** ключевые концепции, relation extraction, event extraction
2. **LLM как вспомогательный инструмент** для аннотации
3. **Сбор, хранение, визуализация** извлечённой информации (BI‑инструменты)

---

## 3) Блок A — Named Entity Recognition (NER)

### `01_ner_spacy_natasha_hf.ipynb`
**Якорь:** как выделить имёна, даты и организации в тексте маркером.

**Что делаем:**
- используем **spaCy** для русского и английского
- пробуем **natasha** — специализированный инструмент для русского
- загружаем NER‑модели из **Hugging Face** (transformers)
- сравниваем качество и скорость

**Мини‑схема**
```
Текст → NER‑модель → Сущности (PER, ORG, LOC, DATE, …)
```

**Микро‑упражнение:**  
Запусти один и тот же текст через spaCy и natasha, сравни результаты.

**Почему важно:** NER — первый шаг для структурирования документов.

---

## 4) Блок B — Information Extraction

### `02_information_extraction.ipynb`
**Якорь:** как найти «кто с кем связан» и «что произошло».

**Что делаем:**
- разбираем **relation extraction** (связи между сущностями)
- пробуем **event extraction** (события и участники)
- используем **LLM** для аннотации (zero-shot, few-shot)
- сравниваем классические подходы и LLM

**Мини‑схема**
```
Текст + Сущности → Relation/Event Extraction → Структурированные факты
```

**Микро‑упражнение:**  
Извлеки отношения из 2–3 предложений с помощью LLM и проверь формат.

**Почему важно:** связи и события дают понимание смысла, а не только список сущностей.

---

## 5) Блок C — Сбор, хранение, визуализация

### `03_storage_visualization.ipynb`
**Якорь:** как сложить находки в папки и показать на дашборде.

**Что делаем:**
- сохраняем извлечённые сущности и связи (JSON, SQLite, pandas)
- загружаем в **Pandas/DataFrame** для анализа
- делаем простую визуализацию (графы, таблицы)
- обзор интеграции с BI‑инструментами (Metabase, Superset, Power BI)

**Мини‑схема**
```
Сущности + Связи → Хранилище → Дашборд / Визуализация
```

**Микро‑упражнение:**  
Построй граф связей между сущностями из одного документа.

**Почему важно:** без хранения и визуализации IE остаётся «чёрным ящиком».

---

## 6) Мини‑примеры кода (ещё подробнее)

### Пример 1: spaCy NER
```python
import spacy
nlp = spacy.load("ru_core_news_sm")  # или en_core_web_sm
doc = nlp("Иван Петров из компании Яндекс встретился в Москве.")
for ent in doc.ents:
    print(ent.text, ent.label_)
# Схема: текст → сущности
```
**Почему важно:** spaCy — быстрый и удобный для EN/RU.

### Пример 2: natasha (русский)
```python
from natasha import Segmenter, MorphVocab, NewsEmbedding, NewsMorphTagger, Doc
segmenter = Segmenter()
emb = NewsEmbedding()
morph_tagger = NewsMorphTagger(emb)
doc = Doc("Глава Роснефти Игорь Сечин выступил в Сочи.")
doc.segment(segmenter).tag_morph(morph_tagger)
# Схема: текст → Doc → разбор
```
**Почему важно:** natasha заточен под русский медиа‑текст.

### Пример 3: Hugging Face NER
```python
from transformers import pipeline
ner = pipeline("ner", model="DeepPavlov/rubert-base-cased-ner-layoutlm")
ents = ner("Договор заключён 15 марта 2024 между ООО Ромашка и ИП Сидоров.")
# Схема: текст → NER pipeline → сущности
```
**Почему важно:** HF даёт специализированные модели под задачу.

### Пример 4: LLM для relation extraction
```python
prompt = """Извлеки отношения между сущностями. Формат: (сущность1, тип_связи, сущность2).
Текст: {text}"""
result = llm.invoke(prompt.format(text=paragraph))
# Схема: текст → LLM → структурированные связи
```
**Почему важно:** LLM гибко подстраивается под новый домен без переобучения.

### Пример 5: Сохранение в DataFrame
```python
import pandas as pd
df = pd.DataFrame([{"entity": e.text, "label": e.label_} for e in doc.ents])
df.to_csv("entities.csv", index=False)
# Схема: сущности → DataFrame → CSV
```
**Почему важно:** pandas — мост к аналитике и BI.

---

## 7) Микро‑проверка (с ответом)

Вопрос: чем NER отличается от relation extraction?  
Ответ: NER находит сущности (слова/фразы), relation extraction — связи между ними.

---

## 8) Итог модуля (4 результата)

- умеешь извлекать сущности (spaCy, natasha, HF)
- понимаешь relation и event extraction
- используешь LLM для аннотации
- сохраняешь и визуализируешь данные для интеграции в приложения

---

Попробуй: открой `01_ner_spacy_natasha_hf.ipynb` и пройди его сверху вниз.
