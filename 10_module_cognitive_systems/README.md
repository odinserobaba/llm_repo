# Модуль 10 — Cognitive Systems (когнитивные системы)

```
┌─────────────────────────────────────────────────────────────┐
│  COGNITIVE SYSTEMS как мозг организации: RAG + графы +      │
│  онтологии + оркестрация — «думающие» системы               │
├────────────┬────────────┬────────────┬──────────────────────┤
│ Якорь     │ Механика   │ Прорыв     │ Применение           │
│ 3 сек     │ 20 сек     │ ✨ 5 сек   │ 10 сек               │
│ Мозг      │ RAG→KG→    │ LangGraph  │ Профиль +            │
│ компании  │ LangGraph  │ state      │ мониторинг           │
└────────────┴────────────┴────────────┴──────────────────────┘
```

---

## 🎯 Якорь + эмоциональный мостик

**🎯 ЯКОРЬ:** Организация — как мозг: память (RAG), знания (графы), рассуждения (LangGraph), классификация (онтологии) и самодиагностика (мониторинг). Cognitive Systems — конструктор таких «умных» систем.

💡 **Эмпатия:** «Звучит как научная фантастика? На деле это слои над RAG и цепочками — как добавить «мышление» к базовой памяти.»

---

## 📖 Термины и понятия

| Термин | Что это | Метафора |
|--------|---------|----------|
| **Cognitive RAG** | RAG с рассуждениями, цепочкой мыслей (CoT) или multi-hop. | 📚 Библиотекарь, который рассуждает вслух |
| **Knowledge Graph** | Узлы (сущности) + рёбра (связи). Структурированное знание. | 🕸️ Паутина фактов |
| **GraphRAG** | Поиск по графу: не только семантика, но и связи между сущностями. | 🗺️ Карта с дорогами между городами |
| **LangGraph** | State machine для LLM: узлы, рёбра, циклы, ветвления. | 🗺️ Карта маршрутов с поворотами |
| **Ontology** | Иерархия понятий и правил (классы, свойства, отношения). | 📋 Каталог с разделами и подразделами |
| **Ontology-based Search** | Поиск по структурированной схеме понятий. Фильтрация по классам. | 🔖 Поиск по каталогу |
| **Profiling** | Замер латентности, токенов, затрат по шагам. | ⏱️ Таймер и счётчик |
| **Monitoring** | Трассировка, алерты, качество в проде. | 📊 Приборная панель |

---

## 📐 Радиальная карта модуля

```
                         ┌──────────────────┐
                         │   COGNITIVE      │ ← ЦЕНТР
                         │   SYSTEMS        │
                         └────────┬─────────┘
              ┌───────────────────┼───────────────────┐
              ↓                   ↓                   ↓
       ┌────────────┐     ┌────────────┐     ┌────────────┐
       │ RAG        │     │ Графы      │     │ Оркестрация│
       │ Cognitive  │     │ + онтологии│     │ + контроль │
       └─────┬──────┘     └─────┬──────┘     └─────┬──────┘
             ↓                   ↓                   ↓
       • Reasoning RAG    • GraphRAG         • LangGraph
       • Self-RAG         • Ontology search  • Profiling
       • Multi-hop       • Schema-driven    • Langfuse/LangSmith
```

---

## 🔷 Прогрессивная схема (3 фазы)

#### Фаза 1: От RAG к Cognitive RAG
```
┌──────────────┐     ┌──────────────┐
│  RAG         │ ─→  │  RAG +       │ рассуждения, multi-hop
│  (базовый)   │     │  reasoning   │
└──────────────┘     └──────────────┘
```

#### Фаза 2: Графы и онтологии
```
┌──────────────┐     ┌──────────────┐
│  Текст       │ ─→  │  KG /       │ сущности, связи, схема
│  + сущности  │     │  Ontology   │
└──────────────┘     └──────┬──────┘
                            ↓
                     поиск по графу / по классам
```

#### Фаза 3: Прорыв ← ✨ LangGraph
```
┌──────────────┐
│  LangGraph   │ StateMachine: узлы, рёбра, циклы, human-in-the-loop
└──────┬───────┘
       ↓
✨ Сложные сценарии: агент, ветвления, повторы, проверки
```

---

## 📊 Таблица контрастов

| Что думают ❌ | Что на самом деле ✅ | Визуальная метафора |
|---------------|---------------------|---------------------|
| «RAG = просто поиск» | Cognitive RAG — рассуждения и multi-hop | `Библиотекарь vs эксперт-аналитик` |
| «Граф = визуализация» | KG — хранилище для семантического поиска | `Карта vs склад координат` |
| «LangGraph = цепочка» | State machine с циклами и ветвлениями | `Линейка vs лабиринт` |
| «Онтология = академика» | Онтологии структурируют поиск и ответы | `Каталог vs куча документов` |
| «Мониторинг = логи» | Traces, метрики, evaluators — приборная панель | `print vs дашборд` |

---

## 💻 Мини-код с комментариями-стрелками

```python
# ← 1. LangGraph: граф состояний
from langgraph.graph import StateGraph
workflow = StateGraph(State)
workflow.add_node("retrieve", retrieve)
workflow.add_node("generate", generate)
workflow.add_edge("retrieve", "generate")
#        ↑
#        └── ✨ ВОТ ЗДЕСЬ: узлы + рёбра = оркестрация

# ← 2. Cognitive RAG: retrieve → reason → generate

# ← 3. Профилирование: config={"run_name": "..."} + Langfuse
```

---

## ✅ Чек-лист самопроверки

```
✅ Проверь себя за 15 секунд:
▫️ Могу объяснить Cognitive RAG vs базовый RAG
▫️ Вижу разницу: KG vs векторный поиск
▫️ Понимаю LangGraph = state machine для LLM
▫️ Знаю, зачем онтологии в поиске
▫️ Могу настроить profiling и мониторинг

→ Если 4+ галочки — уверенно владеешь основой.
```

---

## 🔍 Микро-проверка (с ответом!)

**Вопрос:** Чем LangGraph отличается от обычной цепочки?  
**Ответ:** LangGraph — граф состояний: циклы, ветвления, human-in-the-loop. Цепочка — только линейная последовательность.

**Вопрос:** Зачем онтологии, если есть векторный поиск?  
**Ответ:** Онтологии задают схему понятий. Векторный поиск — сходство текстов. Онтологии дают структурированный контекст и фильтрацию.

---

## ⚠️ Частые ошибки

| Ошибка | Решение |
|--------|---------|
| LangGraph циклится | Проверить условия рёбер, лимиты итераций |
| KG пустой | Проверить NER/IE и маппинг сущностей в граф |
| Трассы не видны | CallbackHandler в `config={"callbacks": [handler]}` |

---

## ➡️ Что дальше

- **Модуль 4** — базовый RAG
- **ДЗ 12** — RAG + Langfuse
- **Практика:** свой cognitive pipeline: RAG → KG → LangGraph

**≈2 ч** — блокноты | **≈4 ч** — свой когнитивный пайплайн

---

## 📁 Структура модуля

| Подпапка | Якорь | Что делаем |
|----------|-------|------------|
| `01_rag_cognitive/` | Библиотекарь-эксперт | Reasoning RAG, Self-RAG |
| `02_knowledge_graphs/` | Паутина фактов | GraphRAG, networkx |
| `03_langgraph/` | Карта маршрутов | StateGraph, агент, циклы |
| `04_ontologies/` | Каталог понятий | Схема, поиск по классам |
| `05_profiling_monitoring/` | Приборная панель | Traces, метрики, evaluators |

---

**Попробуй:** открой `03_langgraph/01_langgraph_state_machines.ipynb` и собери первый граф.
