# LangGraph â€” Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ LLM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LANGGRAPH: ĞºĞ°Ñ€Ñ‚Ğ° Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¾Ğ² â€” Ğ½Ğµ Ğ»Ğ¸Ğ½ĞµĞ¹ĞºĞ°,   â”‚
â”‚  Ğ° Ğ»Ğ°Ğ±Ğ¸Ñ€Ğ¸Ğ½Ñ‚ Ñ Ğ¿Ğ¾Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ°Ğ¼Ğ¸ Ğ¸ Ñ†Ğ¸ĞºĞ»Ğ°Ğ¼Ğ¸          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ğ¯ĞºĞ¾Ñ€ÑŒ   â”‚ ĞœĞµÑ…Ğ°Ğ½Ğ¸ĞºĞ° â”‚ ĞŸÑ€Ğ¾Ñ€Ñ‹Ğ²                 â”‚
â”‚ ĞšĞ°Ñ€Ñ‚Ğ°   â”‚ StateGraphâ”‚ Ğ¦Ğ¸ĞºĞ»Ñ‹, Ğ²ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ñ,     â”‚
â”‚ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¾Ğ²â”‚ ÑƒĞ·Ğ»Ñ‹+Ñ€Ñ‘Ğ±Ñ€Ğ°â”‚ human-in-the-loop     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Ğ¯ĞºĞ¾Ñ€ÑŒ

LangGraph â€” Ğ½Ğµ Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾ Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ° Aâ†’Bâ†’C. Ğ­Ñ‚Ğ¾ **Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ° ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹** (state machine): Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒÑÑ Ğ½Ğ°Ğ·Ğ°Ğ´, Ñ€Ğ°Ğ·Ğ²ĞµÑ‚Ğ²Ğ¸Ñ‚ÑŒÑÑ, Ğ²ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ Â«ÑÑ‚Ğ¾Ğ¿ Ğ¸ ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°Â». ĞšĞ°Ğº ĞºĞ°Ñ€Ñ‚Ğ° Ñ Ğ¿ĞµÑ€ĞµĞºÑ€Ñ‘ÑÑ‚ĞºĞ°Ğ¼Ğ¸, Ğ° Ğ½Ğµ Ğ¾Ğ´Ğ½Ğ° Ğ¿Ñ€ÑĞ¼Ğ°Ñ Ğ´Ğ¾Ñ€Ğ¾Ğ³Ğ°.

---

## ğŸ“– Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½Ñ‹

| Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½ | Ğ§Ñ‚Ğ¾ ÑÑ‚Ğ¾ |
|--------|---------|
| **StateGraph** | Ğ“Ñ€Ğ°Ñ„: ÑƒĞ·Ğ»Ñ‹ = Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸, Ñ€Ñ‘Ğ±Ñ€Ğ° = Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñ‹ Ğ¼ĞµĞ¶Ğ´Ñƒ Ğ½Ğ¸Ğ¼Ğ¸ |
| **Node (ÑƒĞ·ĞµĞ»)** | Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ, Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ÑÑ‰Ğ°Ñ state Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ÑÑ‰Ğ°Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ state |
| **Edge (Ñ€ĞµĞ±Ñ€Ğ¾)** | Ğ¡Ğ²ÑĞ·ÑŒ Â«Ğ¿Ğ¾ÑĞ»Ğµ ÑƒĞ·Ğ»Ğ° A Ğ¿ĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğ² ÑƒĞ·ĞµĞ» BÂ» |
| **add_edge** | Ğ–Ñ‘ÑÑ‚ĞºĞ°Ñ ÑĞ²ÑĞ·ÑŒ: Ğ²ÑĞµĞ³Ğ´Ğ° A â†’ B |
| **add_conditional_edges** | Ğ’ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: Ğ¿Ğ¾ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑƒĞ·ĞµĞ» A, B Ğ¸Ğ»Ğ¸ C |
| **State (ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)** | Ğ¡Ğ»Ğ¾Ğ²Ğ°Ñ€ÑŒ (TypedDict), ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Â«Ñ‚ĞµÑ‡Ñ‘Ñ‚Â» Ğ¿Ğ¾ Ğ³Ñ€Ğ°Ñ„Ñƒ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ² ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¼ ÑƒĞ·Ğ»Ğµ |
| **END** | Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» â€” ĞºĞ¾Ğ½ĞµÑ† Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ |

---

## ğŸ”— Ğ¦ĞµĞ¿Ğ¾Ñ‡ĞºĞ¸: LangChain vs LangGraph

### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Â«Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ¸Â»?

Ğ’ LangChain Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ° â€” ÑÑ‚Ğ¾ **Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ°Ñ** Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚   â”‚ â”€â†’  â”‚   LLM    â”‚ â”€â†’  â”‚  ĞŸĞ°Ñ€ÑĞµÑ€  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **Ğ’Ñ…Ğ¾Ğ´** Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ÑˆĞ°Ğ³Ğ° = **Ğ²Ñ‹Ñ…Ğ¾Ğ´** Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ³Ğ¾.
- ĞŸĞ¾Ñ€ÑĞ´Ğ¾Ğº Ğ·Ğ°Ğ´Ğ°Ğ½ Ğ¾Ğ´Ğ¸Ğ½ Ñ€Ğ°Ğ·.
- ĞĞµÑ‚ Ğ²ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ğ¹, Ğ½ĞµÑ‚ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ¾Ğ².

**Ğ¡Ğ¸Ğ½Ñ‚Ğ°ĞºÑĞ¸Ñ LCEL:** `chain = prompt \| llm \| parser`

### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ¸ Ğ½Ğµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚?

Ğ ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚:

1. **Ğ’ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:** Â«ĞÑ‚Ğ²ĞµÑ‚ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹? â†’ ĞºĞ¾Ğ½ĞµÑ†. ĞŸĞ»Ğ¾Ñ…Ğ¾Ğ¹? â†’ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸ retrievalÂ»
2. **Ğ¦Ğ¸ĞºĞ»Ñ‹:** Â«Ğ“ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ â†’ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑŒ â†’ ĞµÑĞ»Ğ¸ Ğ½Ğµ Ğ¾Ğº, Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞ¹ ÑĞ½Ğ¾Ğ²Ğ°Â»
3. **Human-in-the-loop:** Â«Ğ¡Ñ‚Ğ¾Ğ¿, ÑĞ¿Ñ€Ğ¾ÑĞ¸ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°, Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸ Ñ ĞµĞ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ¼Â»
4. **ĞŸĞ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ²ĞµÑ‚ĞºĞ¸:** Â«ĞĞ´Ğ½Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾: retrieval + ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸ÑÂ»

Ğ¦ĞµĞ¿Ğ¾Ñ‡ĞºĞ° â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€ÑĞ¼Ğ°Ñ Ğ»Ğ¸Ğ½Ğ¸Ñ. Ğ”Ğ»Ñ ÑÑ‚Ğ¾Ğ³Ğ¾ Ğ¸ Ğ½ÑƒĞ¶ĞµĞ½ **Ğ³Ñ€Ğ°Ñ„ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğ¹**.

---

## ğŸ— ĞšĞ°Ğº ÑÑ‚Ñ€Ğ¾ÑÑ‚ÑÑ Ğ³Ñ€Ğ°Ñ„Ñ‹ Ğ² LangGraph

### Ğ¨Ğ°Ğ³ 1: ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ State (ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ)

State â€” ÑÑ‚Ğ¾ **Ğ¾Ğ±Ñ‰Ğ°Ñ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ** Ğ³Ñ€Ğ°Ñ„Ğ°. Ğ’ÑĞµ ÑƒĞ·Ğ»Ñ‹ Ñ‡Ğ¸Ñ‚Ğ°ÑÑ‚ Ğ¸ Ğ¿Ğ¸ÑˆÑƒÑ‚ Ğ² Ğ½ĞµĞ³Ğ¾.

```python
from typing import TypedDict

class State(TypedDict):
    messages: list       # Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ´Ğ¸Ğ°Ğ»Ğ¾Ğ³Ğ°
    context: list        # Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ (Ğ´Ğ»Ñ RAG)
    needs_retry: bool    # Ñ„Ğ»Ğ°Ğ³: Ğ½ÑƒĞ¶ĞµĞ½ Ğ»Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€
```

- ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ `state` Ğ½Ğ° Ğ²Ñ…Ğ¾Ğ´Ğµ.
- Ğ£Ğ·ĞµĞ» Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ **dict Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸** â€” Ğ¾Ğ½Ğ¸ **ÑĞ»Ğ¸Ğ²Ğ°ÑÑ‚ÑÑ** Ñ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¼ state (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· `operator.add` Ğ´Ğ»Ñ ÑĞ¿Ğ¸ÑĞºĞ¾Ğ²).

### Ğ¨Ğ°Ğ³ 2: Ğ£Ğ·Ğ»Ñ‹ â€” ÑÑ‚Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸

Ğ£Ğ·ĞµĞ» = Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ `(state) â†’ dict`:

```python
def retrieve(state: State) -> dict:
    docs = retriever.invoke(state["messages"][-1].content)
    return {"context": docs}  # Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ context

def generate(state: State) -> dict:
    prompt = make_prompt(state["context"], state["messages"])
    answer = llm.invoke(prompt)
    return {"messages": state["messages"] + [answer]}
```

Ğ£Ğ·ĞµĞ» **Ğ½Ğµ Ğ¼ĞµĞ½ÑĞµÑ‚** state Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ â€” Ğ¾Ğ½ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ **Ğ´ĞµĞ»ÑŒÑ‚Ñƒ**. LangGraph ÑĞ°Ğ¼ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ ĞµÑ‘ Ğº state.

### Ğ¨Ğ°Ğ³ 3: Ğ Ñ‘Ğ±Ñ€Ğ° â€” ĞºĞ°Ğº ÑĞ²ÑĞ·Ğ°Ñ‚ÑŒ ÑƒĞ·Ğ»Ñ‹

| Ğ¢Ğ¸Ğ¿ | ĞšĞ°Ğº Ğ·Ğ°Ğ´Ğ°Ñ‚ÑŒ | ĞšĞ¾Ğ³Ğ´Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ |
|-----|------------|---------------------|
| **Ğ–Ñ‘ÑÑ‚ĞºĞ¾Ğµ Ñ€ĞµĞ±Ñ€Ğ¾** | `add_edge("A", "B")` | Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿Ğ¾ÑĞ»Ğµ A Ğ¸Ğ´Ñ‘Ğ¼ Ğ² B |
| **Ğ£ÑĞ»Ğ¾Ğ²Ğ½Ğ¾Ğµ Ñ€ĞµĞ±Ñ€Ğ¾** | `add_conditional_edges("A", router_fn, {"x": "X", "y": "Y"})` | Router Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ "x" Ğ¸Ğ»Ğ¸ "y" â€” Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑƒĞ·ĞµĞ» |
| **Ğ’ ĞºĞ¾Ğ½ĞµÑ†** | `add_edge("A", END)` | ĞŸĞ¾ÑĞ»Ğµ A Ğ³Ñ€Ğ°Ñ„ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµÑ‚ÑÑ |

### Ğ¨Ğ°Ğ³ 4: Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° Ğ³Ñ€Ğ°Ñ„Ğ°

```python
workflow = StateGraph(State)

# Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ÑƒĞ·Ğ»Ñ‹
workflow.add_node("retrieve", retrieve)
workflow.add_node("generate", generate)
workflow.add_node("validate", validate)

# Ğ Ñ‘Ğ±Ñ€Ğ°
workflow.add_edge("retrieve", "generate")
workflow.add_conditional_edges("generate", router, {"retry": "retrieve", "end": END})

# ĞšĞ¾Ğ¼Ğ¿Ğ¸Ğ»ÑÑ†Ğ¸Ñ
app = workflow.compile()
```

---

## ğŸŒ¿ ĞšĞ°Ğº Ğ¿Ñ€Ğ¾Ğ¸ÑÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ²ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

### Ğ£ÑĞ»Ğ¾Ğ²Ğ½Ğ¾Ğµ Ñ€ĞµĞ±Ñ€Ğ¾ (conditional edge)

Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ-Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ **state** Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ **ĞºĞ»ÑÑ‡** â€” Ğ¸Ğ¼Ñ ÑĞ»ĞµĞ´ÑƒÑÑ‰ĞµĞ³Ğ¾ ÑƒĞ·Ğ»Ğ°:

```python
def router(state: State) -> str:
    last_message = state["messages"][-1]
    if "Ğ½Ğµ Ğ·Ğ½Ğ°Ñ" in last_message.content.lower():
        return "retry"   # â†’ Ğ¸Ğ´Ñ‘Ğ¼ Ğ² retrieve
    return "end"         # â†’ Ğ¸Ğ´Ñ‘Ğ¼ Ğ² END

workflow.add_conditional_edges("generate", router, {"retry": "retrieve", "end": END})
```

**ĞšĞ°Ğº ÑÑ‚Ğ¾ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¿Ğ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ¾:**

1. Ğ£Ğ·ĞµĞ» `generate` Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ğ»ÑÑ, state Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½.
2. LangGraph Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ `router(state)`.
3. `router` Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `"retry"` Ğ¸Ğ»Ğ¸ `"end"`.
4. ĞŸĞ¾ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ñ‘Ğ½Ğ½Ğ¾Ğ¼Ñƒ ĞºĞ»ÑÑ‡Ñƒ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ÑÑ ÑƒĞ·ĞµĞ»: `"retry"` â†’ `retrieve`, `"end"` â†’ `END`.
5. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ² Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» (Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ°ĞµÑ‚ÑÑ).

### Ğ¡Ñ…ĞµĞ¼Ğ° Ğ²ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ñ

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   generate   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    router(state)
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â†“                         â†“
       return "retry"            return "end"
              â†“                         â†“
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”
       â”‚   retrieve   â”‚            â”‚ END â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”˜
              â”‚
              â””â”€â”€â†’ Ñ†Ğ¸ĞºĞ»: ÑĞ½Ğ¾Ğ²Ğ° generate
```

### ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ğ¸Ğ¼ĞµĞ½Ğ½Ğ¾ Ñ‚Ğ°Ğº?

- **Ğ Ğ¾ÑƒÑ‚ĞµÑ€ = Ñ‡Ğ¸ÑÑ‚Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ¾Ñ‚ state.** Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ÑÑ Ğ½Ğ° Ğ¾ÑĞ½Ğ¾Ğ²Ğµ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ±ĞµĞ· Ğ¿Ğ¾Ğ±Ğ¾Ñ‡Ğ½Ñ‹Ñ… ÑÑ„Ñ„ĞµĞºÑ‚Ğ¾Ğ².
- **ĞšĞ»ÑÑ‡Ğ¸ Ğ² Ğ¼Ğ°Ğ¿Ğ¿Ğ¸Ğ½Ğ³Ğµ** ÑĞ²Ğ½Ğ¾ ÑĞ²ÑĞ·Ñ‹Ğ²Ğ°ÑÑ‚ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ñ ÑƒĞ·Ğ»Ğ¾Ğ¼. Ğ›ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ğ²ĞµÑ‚ĞºĞ¸.
- **Ğ¦Ğ¸ĞºĞ»Ñ‹ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹:** `retrieve â†’ generate â†’ router â†’ retrieve` â€” Ñ‚Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ retry-Ğ¿Ğ°Ñ‚Ñ‚ĞµÑ€Ğ½.

---

## ğŸ”„ Ğ¦Ğ¸ĞºĞ»Ñ‹ Ğ¸ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ¸Ñ

Ğ¦Ğ¸ĞºĞ» Ğ²Ğ¾Ğ·Ğ½Ğ¸ĞºĞ°ĞµÑ‚, ĞºĞ¾Ğ³Ğ´Ğ° Ñ€ĞµĞ±Ñ€Ğ¾ Ğ²ĞµĞ´Ñ‘Ñ‚ **Ğ½Ğ°Ğ·Ğ°Ğ´** Ğº ÑƒĞ¶Ğµ Ğ¿Ñ€Ğ¾Ğ¹Ğ´ĞµĞ½Ğ½Ğ¾Ğ¼Ñƒ ÑƒĞ·Ğ»Ñƒ:

```
retrieve â†’ generate â†’ [router] â†’ retrieve â†’ generate â†’ ...
```

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:** Ğ±ĞµÑĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ», ĞµÑĞ»Ğ¸ Ñ€Ğ¾ÑƒÑ‚ĞµÑ€ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ `"retry"`.

**Ğ ĞµÑˆĞµĞ½Ğ¸Ğµ:** LangGraph Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ `recursion_limit` (Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ 25):

```python
app = workflow.compile(checkpointer=..., recursion_limit=10)
```

ĞŸĞ¾ÑĞ»Ğµ 10 Â«Ğ²Ğ¸Ñ‚ĞºĞ¾Ğ²Â» Ğ¿Ğ¾ Ñ†Ğ¸ĞºĞ»Ñƒ Ğ³Ñ€Ğ°Ñ„ Ğ¿Ñ€Ğ¸Ğ½ÑƒĞ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ğ¾ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ.

---

## ğŸ“ ĞŸĞ¾Ğ»Ğ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°: Ğ¾Ñ‚ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ° Ğ´Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°

```
1. app.invoke({"messages": [HumanMessage("Ğ§Ñ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğµ RAG?")]})
         â”‚
         â†“
2. State Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½: {messages: [...], context: []}
         â”‚
         â†“
3. Ğ¡Ñ‚Ğ°Ñ€Ñ‚Ğ¾Ğ²Ñ‹Ğ¹ ÑƒĞ·ĞµĞ»: "retrieve" (Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğ¹)
         â”‚
         â†“
4. retrieve(state) â†’ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ {context: [doc1, doc2, ...]}
         â”‚
         â†“
5. State Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½. ĞŸĞ¾ add_edge("retrieve", "generate") â†’ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ² "generate"
         â”‚
         â†“
6. generate(state) â†’ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ LLM, Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ {messages: [...]}
         â”‚
         â†“
7. State Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»Ñ‘Ğ½. ĞŸĞ¾ add_conditional_edges â†’ Ğ²Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ router(state)
         â”‚
         â†“
8. router Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ "end" â†’ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ² END
         â”‚
         â†“
9. Ğ“Ñ€Ğ°Ñ„ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµĞ¼ Ñ„Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ state.
```

---

## ğŸ“Š Ğ¡Ñ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ğµ: Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ° vs Ğ³Ñ€Ğ°Ñ„

| ĞÑĞ¿ĞµĞºÑ‚ | LangChain (Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ°) | LangGraph (Ğ³Ñ€Ğ°Ñ„) |
|--------|---------------------|------------------|
| Ğ¢Ñ€Ğ°ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ | Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ°Ñ Aâ†’Bâ†’C | Ğ’ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ñ, Ñ†Ğ¸ĞºĞ»Ñ‹ |
| Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ | ĞŸĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ¿Ğ¾ Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞµ Ğ½ĞµÑĞ²Ğ½Ğ¾ | Ğ¯Ğ²Ğ½Ñ‹Ğ¹ State, Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ÑƒĞ·Ğ»Ğ¾Ğ² |
| Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ | Ğ§ĞµÑ€ĞµĞ· RunnableBranch (Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ğ½Ğ¾) | add_conditional_edges â€” Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ€Ğ¾ÑƒÑ‚Ğ¸Ğ½Ğ³ |
| Ğ¦Ğ¸ĞºĞ»Ñ‹ | ĞĞµÑ‚ | Ğ”Ğ° (retry, agent loop) |
| Human-in-the-loop | Ğ¡Ğ»Ğ¾Ğ¶Ğ½Ğ¾ | Ğ¡Ğ¿ĞµÑ†Ğ¸Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑƒĞ·ĞµĞ» + Ğ¿Ñ€ĞµÑ€Ñ‹Ğ²Ğ°Ğ½Ğ¸Ğµ |

---

## ğŸ’» ĞœĞ¸Ğ½Ğ¸-ĞºĞ¾Ğ´ Ñ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸ÑĞ¼Ğ¸

```python
# â† 1. Ğ¡Ğ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ â€” Ğ¾Ğ±Ñ‰Ğ°Ñ Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ Ğ³Ñ€Ğ°Ñ„Ğ°
class State(TypedDict):
    messages: list

# â† 2. Ğ£Ğ·Ğ»Ñ‹: ĞºĞ°Ğ¶Ğ´Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞĞ‘ĞĞĞ’Ğ›Ğ•ĞĞ˜Ğ• state
def retrieve(state): return {"context": [...]}
def generate(state): return {"messages": state["messages"] + [response]}

# â† 3. Ğ Ğ¾ÑƒÑ‚ĞµÑ€ Ğ´Ğ»Ñ Ğ²ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ñ: Ğ¿Ğ¾ state Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğ¹ ÑƒĞ·ĞµĞ»
def router(state):
    return "retry" if needs_retry(state) else "end"

# â† 4. Ğ¡Ğ±Ğ¾Ñ€ĞºĞ°: ÑƒĞ·Ğ»Ñ‹ + Ñ€Ñ‘Ğ±Ñ€Ğ° (Ğ¶Ñ‘ÑÑ‚ĞºĞ¸Ğµ Ğ¸ ÑƒÑĞ»Ğ¾Ğ²Ğ½Ñ‹Ğµ)
workflow = StateGraph(State)
workflow.add_node("retrieve", retrieve)
workflow.add_node("generate", generate)
workflow.add_edge("retrieve", "generate")
workflow.add_conditional_edges("generate", router, {"retry": "retrieve", "end": END})
#        â†‘
#        â””â”€â”€ âœ¨ Ğ’ĞĞ¢ Ğ—Ğ”Ğ•Ğ¡Ğ¬ ĞœĞĞ“Ğ˜Ğ¯: router(state) Ñ€ĞµÑˆĞ°ĞµÑ‚, ĞºÑƒĞ´Ğ° Ğ¸Ğ´Ñ‚Ğ¸ Ğ´Ğ°Ğ»ÑŒÑˆĞµ

app = workflow.compile()
result = app.invoke({"messages": [HumanMessage("...")]})
```

---

## âœ… Ğ§ĞµĞº-Ğ»Ğ¸ÑÑ‚

```
â–«ï¸ ĞŸĞ¾Ğ½Ğ¸Ğ¼Ğ°Ñ: Ñ†ĞµĞ¿Ğ¾Ñ‡ĞºĞ° = Ğ»Ğ¸Ğ½ĞµĞ¹Ğ½Ğ°Ñ, Ğ³Ñ€Ğ°Ñ„ = Ñ Ğ²ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸ÑĞ¼Ğ¸ Ğ¸ Ñ†Ğ¸ĞºĞ»Ğ°Ğ¼Ğ¸
â–«ï¸ Ğ—Ğ½Ğ°Ñ: ÑƒĞ·ĞµĞ» Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ dict-Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ state, Ğ° Ğ½Ğµ Ğ²ĞµÑÑŒ state
â–«ï¸ Ğ’Ğ¸Ğ¶Ñƒ: add_conditional_edges = router(state) â†’ ĞºĞ»ÑÑ‡ â†’ Ğ²Ñ‹Ğ±Ğ¾Ñ€ ÑƒĞ·Ğ»Ğ°
â–«ï¸ ĞŸĞ¾Ğ¼Ğ½Ñ: Ñ†Ğ¸ĞºĞ»Ñ‹ Ğ¾Ğ³Ñ€Ğ°Ğ½Ğ¸Ñ‡ĞµĞ½Ñ‹ recursion_limit
```

---

## ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹

| Ğ¤Ğ°Ğ¹Ğ» | ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ |
|------|----------|
| `01_langgraph_state_machines.ipynb` | StateGraph, Ñ†Ğ¸ĞºĞ»Ñ‹, Ğ²ĞµÑ‚Ğ²Ğ»ĞµĞ½Ğ¸Ñ, Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ ĞºĞ¾Ğ´Ğ° |
