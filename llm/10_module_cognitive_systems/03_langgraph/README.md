# LangGraph ‚Äî –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è LLM

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  LANGGRAPH: –∫–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ ‚Äî –Ω–µ –ª–∏–Ω–µ–π–∫–∞,   ‚îÇ
‚îÇ  –∞ –ª–∞–±–∏—Ä–∏–Ω—Ç —Å –ø–æ–≤–æ—Ä–æ—Ç–∞–º–∏ –∏ —Ü–∏–∫–ª–∞–º–∏          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –Ø–∫–æ—Ä—å   ‚îÇ –ú–µ—Ö–∞–Ω–∏–∫–∞ ‚îÇ –ü—Ä–æ—Ä—ã–≤                 ‚îÇ
‚îÇ –ö–∞—Ä—Ç–∞   ‚îÇ StateGraph‚îÇ –¶–∏–∫–ª—ã, –≤–µ—Ç–≤–ª–µ–Ω–∏—è,     ‚îÇ
‚îÇ –º–∞—Ä—à—Ä—É—Ç–æ–≤‚îÇ —É–∑–ª—ã+—Ä—ë–±—Ä–∞‚îÇ human-in-the-loop     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ –Ø–∫–æ—Ä—å

LangGraph ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ü–µ–ø–æ—á–∫–∞ A‚ÜíB‚ÜíC. –≠—Ç–æ **–º–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π** (state machine): –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥, —Ä–∞–∑–≤–µ—Ç–≤–∏—Ç—å—Å—è, –≤—Å—Ç–∞–≤–∏—Ç—å ¬´—Å—Ç–æ–ø –∏ —Å–ø—Ä–æ—Å–∏ —á–µ–ª–æ–≤–µ–∫–∞¬ª. –ö–∞–∫ –∫–∞—Ä—Ç–∞ —Å –ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–∫–∞–º–∏, –∞ –Ω–µ –æ–¥–Ω–∞ –ø—Ä—è–º–∞—è –¥–æ—Ä–æ–≥–∞.

---

## üìñ –¢–µ—Ä–º–∏–Ω—ã

| –¢–µ—Ä–º–∏–Ω | –ß—Ç–æ —ç—Ç–æ |
|--------|---------|
| **StateGraph** | –ì—Ä–∞—Ñ: —É–∑–ª—ã = —Ñ—É–Ω–∫—Ü–∏–∏, —Ä—ë–±—Ä–∞ = –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –Ω–∏–º–∏ |
| **Node (—É–∑–µ–ª)** | –§—É–Ω–∫—Ü–∏—è, –ø—Ä–∏–Ω–∏–º–∞—é—â–∞—è state –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ state |
| **Edge (—Ä–µ–±—Ä–æ)** | –°–≤—è–∑—å ¬´–ø–æ—Å–ª–µ —É–∑–ª–∞ A –ø–µ—Ä–µ–π—Ç–∏ –≤ —É–∑–µ–ª B¬ª |
| **add_edge** | –ñ—ë—Å—Ç–∫–∞—è —Å–≤—è–∑—å: –≤—Å–µ–≥–¥–∞ A ‚Üí B |
| **add_conditional_edges** | –í–µ—Ç–≤–ª–µ–Ω–∏–µ: –ø–æ —É—Å–ª–æ–≤–∏—é –≤—ã–±–∏—Ä–∞–µ–º —É–∑–µ–ª A, B –∏–ª–∏ C |
| **State (—Å–æ—Å—Ç–æ—è–Ω–∏–µ)** | –°–ª–æ–≤–∞—Ä—å (TypedDict), –∫–æ—Ç–æ—Ä—ã–π ¬´—Ç–µ—á—ë—Ç¬ª –ø–æ –≥—Ä–∞—Ñ—É –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –∫–∞–∂–¥–æ–º —É–∑–ª–µ |
| **END** | –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —É–∑–µ–ª ‚Äî –∫–æ–Ω–µ—Ü –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |

---

## üîó –¶–µ–ø–æ—á–∫–∏: LangChain vs LangGraph

### –ü–æ—á–µ–º—É ¬´—Ü–µ–ø–æ—á–∫–∏¬ª?

–í LangChain —Ü–µ–ø–æ—á–∫–∞ ‚Äî —ç—Ç–æ **–ª–∏–Ω–µ–π–Ω–∞—è** –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü—Ä–æ–º–ø—Ç   ‚îÇ ‚îÄ‚Üí  ‚îÇ   LLM    ‚îÇ ‚îÄ‚Üí  ‚îÇ  –ü–∞—Ä—Å–µ—Ä  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

- **–í—Ö–æ–¥** –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞ = **–≤—ã—Ö–æ–¥** –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ.
- –ü–æ—Ä—è–¥–æ–∫ –∑–∞–¥–∞–Ω –æ–¥–∏–Ω —Ä–∞–∑.
- –ù–µ—Ç –≤–µ—Ç–≤–ª–µ–Ω–∏–π, –Ω–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç–æ–≤.

**–°–∏–Ω—Ç–∞–∫—Å–∏—Å LCEL:** `chain = prompt \| llm \| parser`

### –ü–æ—á–µ–º—É —Ü–µ–ø–æ—á–∫–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç?

–†–µ–∞–ª—å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ç—Ä–µ–±—É—é—Ç:

1. **–í–µ—Ç–≤–ª–µ–Ω–∏–µ:** ¬´–û—Ç–≤–µ—Ç —Ö–æ—Ä–æ—à–∏–π? ‚Üí –∫–æ–Ω–µ—Ü. –ü–ª–æ—Ö–æ–π? ‚Üí –ø–æ–≤—Ç–æ—Ä–∏ retrieval¬ª
2. **–¶–∏–∫–ª—ã:** ¬´–ì–µ–Ω–µ—Ä–∏—Ä—É–π ‚Üí –ø—Ä–æ–≤–µ—Ä—å ‚Üí –µ—Å–ª–∏ –Ω–µ –æ–∫, –≥–µ–Ω–µ—Ä–∏—Ä—É–π —Å–Ω–æ–≤–∞¬ª
3. **Human-in-the-loop:** ¬´–°—Ç–æ–ø, —Å–ø—Ä–æ—Å–∏ —á–µ–ª–æ–≤–µ–∫–∞, –ø—Ä–æ–¥–æ–ª–∂–∏ —Å –µ–≥–æ –æ—Ç–≤–µ—Ç–æ–º¬ª
4. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏:** ¬´–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ: retrieval + –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è¬ª

–¶–µ–ø–æ—á–∫–∞ ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä—è–º–∞—è –ª–∏–Ω–∏—è. –î–ª—è —ç—Ç–æ–≥–æ –∏ –Ω—É–∂–µ–Ω **–≥—Ä–∞—Ñ —Å–æ—Å—Ç–æ—è–Ω–∏–π**.

---

## üèó –ö–∞–∫ —Å—Ç—Ä–æ—è—Ç—Å—è –≥—Ä–∞—Ñ—ã –≤ LangGraph

### –®–∞–≥ 1: –û–ø—Ä–µ–¥–µ–ª—è–µ–º State (—Å–æ—Å—Ç–æ—è–Ω–∏–µ)

State ‚Äî —ç—Ç–æ **–æ–±—â–∞—è –ø–∞–º—è—Ç—å** –≥—Ä–∞—Ñ–∞. –í—Å–µ —É–∑–ª—ã —á–∏—Ç–∞—é—Ç –∏ –ø–∏—à—É—Ç –≤ –Ω–µ–≥–æ.

```python
from typing import TypedDict

class State(TypedDict):
    messages: list       # –∏—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–∞
    context: list        # –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (–¥–ª—è RAG)
    needs_retry: bool    # —Ñ–ª–∞–≥: –Ω—É–∂–µ–Ω –ª–∏ –ø–æ–≤—Ç–æ—Ä
```

- –ö–∞–∂–¥—ã–π —É–∑–µ–ª –ø–æ–ª—É—á–∞–µ—Ç `state` –Ω–∞ –≤—Ö–æ–¥–µ.
- –£–∑–µ–ª –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **dict —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏** ‚Äî –æ–Ω–∏ **—Å–ª–∏–≤–∞—é—Ç—Å—è** —Å —Ç–µ–∫—É—â–∏–º state (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–µ–∑ `operator.add` –¥–ª—è —Å–ø–∏—Å–∫–æ–≤).

### –®–∞–≥ 2: –£–∑–ª—ã ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏

–£–∑–µ–ª = —Ñ—É–Ω–∫—Ü–∏—è `(state) ‚Üí dict`:

```python
def retrieve(state: State) -> dict:
    docs = retriever.invoke(state["messages"][-1].content)
    return {"context": docs}  # –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ context

def generate(state: State) -> dict:
    prompt = make_prompt(state["context"], state["messages"])
    answer = llm.invoke(prompt)
    return {"messages": state["messages"] + [answer]}
```

–£–∑–µ–ª **–Ω–µ –º–µ–Ω—è–µ—Ç** state –Ω–∞–ø—Ä—è–º—É—é ‚Äî –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–¥–µ–ª—å—Ç—É**. LangGraph —Å–∞–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç –µ—ë –∫ state.

### –®–∞–≥ 3: –†—ë–±—Ä–∞ ‚Äî –∫–∞–∫ —Å–≤—è–∑–∞—Ç—å —É–∑–ª—ã

| –¢–∏–ø | –ö–∞–∫ –∑–∞–¥–∞—Ç—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-----|------------|---------------------|
| **–ñ—ë—Å—Ç–∫–æ–µ —Ä–µ–±—Ä–æ** | `add_edge("A", "B")` | –í—Å–µ–≥–¥–∞ –ø–æ—Å–ª–µ A –∏–¥—ë–º –≤ B |
| **–£—Å–ª–æ–≤–Ω–æ–µ —Ä–µ–±—Ä–æ** | `add_conditional_edges("A", router_fn, {"x": "X", "y": "Y"})` | Router –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "x" –∏–ª–∏ "y" ‚Äî –≤—ã–±–∏—Ä–∞–µ–º —É–∑–µ–ª |
| **–í –∫–æ–Ω–µ—Ü** | `add_edge("A", END)` | –ü–æ—Å–ª–µ A –≥—Ä–∞—Ñ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è |

### –®–∞–≥ 4: –°–±–æ—Ä–∫–∞ –≥—Ä–∞—Ñ–∞

```python
workflow = StateGraph(State)

# –î–æ–±–∞–≤–ª—è–µ–º —É–∑–ª—ã
workflow.add_node("retrieve", retrieve)
workflow.add_node("generate", generate)
workflow.add_node("validate", validate)

# –†—ë–±—Ä–∞
workflow.add_edge("retrieve", "generate")
workflow.add_conditional_edges("generate", router, {"retry": "retrieve", "end": END})

# –ö–æ–º–ø–∏–ª—è—Ü–∏—è
app = workflow.compile()
```

---

## üåø –ö–∞–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–µ—Ç–≤–ª–µ–Ω–∏–µ

### –£—Å–ª–æ–≤–Ω–æ–µ —Ä–µ–±—Ä–æ (conditional edge)

–§—É–Ω–∫—Ü–∏—è-—Ä–æ—É—Ç–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç **state** –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–∫–ª—é—á** ‚Äî –∏–º—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É–∑–ª–∞:

```python
def router(state: State) -> str:
    last_message = state["messages"][-1]
    if "–Ω–µ –∑–Ω–∞—é" in last_message.content.lower():
        return "retry"   # ‚Üí –∏–¥—ë–º –≤ retrieve
    return "end"         # ‚Üí –∏–¥—ë–º –≤ END

workflow.add_conditional_edges("generate", router, {"retry": "retrieve", "end": END})
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ:**

1. –£–∑–µ–ª `generate` –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è, state –æ–±–Ω–æ–≤–ª—ë–Ω.
2. LangGraph –≤—ã–∑—ã–≤–∞–µ—Ç `router(state)`.
3. `router` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `"retry"` –∏–ª–∏ `"end"`.
4. –ü–æ –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–º—É –∫–ª—é—á—É –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —É–∑–µ–ª: `"retry"` ‚Üí `retrieve`, `"end"` ‚Üí `END`.
5. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π —É–∑–µ–ª (–∏–ª–∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è).

### –°—Ö–µ–º–∞ –≤–µ—Ç–≤–ª–µ–Ω–∏—è

```
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇ   generate   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                    router(state)
                           ‚îÇ
              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
              ‚Üì                         ‚Üì
       return "retry"            return "end"
              ‚Üì                         ‚Üì
       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ   retrieve   ‚îÇ            ‚îÇ END ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚îî‚îÄ‚îÄ‚Üí —Ü–∏–∫–ª: —Å–Ω–æ–≤–∞ generate
```

### –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —Ç–∞–∫?

- **–†–æ—É—Ç–µ—Ä = —á–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç state.** –†–µ—à–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –±–µ–∑ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.
- **–ö–ª—é—á–∏ –≤ –º–∞–ø–ø–∏–Ω–≥–µ** —è–≤–Ω–æ —Å–≤—è–∑—ã–≤–∞—é—Ç —Ä–µ—à–µ–Ω–∏–µ —Å —É–∑–ª–æ–º. –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –≤–µ—Ç–∫–∏.
- **–¶–∏–∫–ª—ã –≤–æ–∑–º–æ–∂–Ω—ã:** `retrieve ‚Üí generate ‚Üí router ‚Üí retrieve` ‚Äî —Ç–∏–ø–∏—á–Ω—ã–π retry-–ø–∞—Ç—Ç–µ—Ä–Ω.

---

## üîÑ –¶–∏–∫–ª—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

–¶–∏–∫–ª –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ —Ä–µ–±—Ä–æ –≤–µ–¥—ë—Ç **–Ω–∞–∑–∞–¥** –∫ —É–∂–µ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–º—É —É–∑–ª—É:

```
retrieve ‚Üí generate ‚Üí [router] ‚Üí retrieve ‚Üí generate ‚Üí ...
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª, –µ—Å–ª–∏ —Ä–æ—É—Ç–µ—Ä –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `"retry"`.

**–†–µ—à–µ–Ω–∏–µ:** LangGraph –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `recursion_limit` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 25):

```python
app = workflow.compile(checkpointer=..., recursion_limit=10)
```

–ü–æ—Å–ª–µ 10 ¬´–≤–∏—Ç–∫–æ–≤¬ª –ø–æ —Ü–∏–∫–ª—É –≥—Ä–∞—Ñ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

---

## üìê –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞: –æ—Ç –≤—ã–∑–æ–≤–∞ –¥–æ –æ—Ç–≤–µ—Ç–∞

```
1. app.invoke({"messages": [HumanMessage("–ß—Ç–æ —Ç–∞–∫–æ–µ RAG?")]})
         ‚îÇ
         ‚Üì
2. State –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω: {messages: [...], context: []}
         ‚îÇ
         ‚Üì
3. –°—Ç–∞—Ä—Ç–æ–≤—ã–π —É–∑–µ–ª: "retrieve" (–∏–ª–∏ –ø–µ—Ä–≤—ã–π –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π)
         ‚îÇ
         ‚Üì
4. retrieve(state) ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {context: [doc1, doc2, ...]}
         ‚îÇ
         ‚Üì
5. State –æ–±–Ω–æ–≤–ª—ë–Ω. –ü–æ add_edge("retrieve", "generate") ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ "generate"
         ‚îÇ
         ‚Üì
6. generate(state) ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç LLM, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç {messages: [...]}
         ‚îÇ
         ‚Üì
7. State –æ–±–Ω–æ–≤–ª—ë–Ω. –ü–æ add_conditional_edges ‚Üí –≤—ã–∑—ã–≤–∞–µ–º router(state)
         ‚îÇ
         ‚Üì
8. router –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç "end" ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ END
         ‚îÇ
         ‚Üì
9. –ì—Ä–∞—Ñ –∑–∞–≤–µ—Ä—à—ë–Ω. –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π state.
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: —Ü–µ–ø–æ—á–∫–∞ vs –≥—Ä–∞—Ñ

| –ê—Å–ø–µ–∫—Ç | LangChain (—Ü–µ–ø–æ—á–∫–∞) | LangGraph (–≥—Ä–∞—Ñ) |
|--------|---------------------|------------------|
| –¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è | –¢–æ–ª—å–∫–æ –ª–∏–Ω–µ–π–Ω–∞—è A‚ÜíB‚ÜíC | –í–µ—Ç–≤–ª–µ–Ω–∏—è, —Ü–∏–∫–ª—ã |
| –°–æ—Å—Ç–æ—è–Ω–∏–µ | –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–æ —Ü–µ–ø–æ—á–∫–µ –Ω–µ—è–≤–Ω–æ | –Ø–≤–Ω—ã–π State, –æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤ |
| –£—Å–ª–æ–≤–∏—è | –ß–µ—Ä–µ–∑ RunnableBranch (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ) | add_conditional_edges ‚Äî –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ä–æ—É—Ç–∏–Ω–≥ |
| –¶–∏–∫–ª—ã | –ù–µ—Ç | –î–∞ (retry, agent loop) |
| Human-in-the-loop | –°–ª–æ–∂–Ω–æ | –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —É–∑–µ–ª + –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ |

---

## üíª –ú–∏–Ω–∏-–∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏

```python
# ‚Üê 1. –°–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –æ–±—â–∞—è –ø–∞–º—è—Ç—å –≥—Ä–∞—Ñ–∞
class State(TypedDict):
    messages: list

# ‚Üê 2. –£–∑–ª—ã: –∫–∞–∂–¥–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –û–ë–ù–û–í–õ–ï–ù–ò–ï state
def retrieve(state): return {"context": [...]}
def generate(state): return {"messages": state["messages"] + [response]}

# ‚Üê 3. –†–æ—É—Ç–µ—Ä –¥–ª—è –≤–µ—Ç–≤–ª–µ–Ω–∏—è: –ø–æ state –≤—ã–±–∏—Ä–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π —É–∑–µ–ª
def router(state):
    return "retry" if needs_retry(state) else "end"

# ‚Üê 4. –°–±–æ—Ä–∫–∞: —É–∑–ª—ã + —Ä—ë–±—Ä–∞ (–∂—ë—Å—Ç–∫–∏–µ –∏ —É—Å–ª–æ–≤–Ω—ã–µ)
workflow = StateGraph(State)
workflow.add_node("retrieve", retrieve)
workflow.add_node("generate", generate)
workflow.add_edge("retrieve", "generate")
workflow.add_conditional_edges("generate", router, {"retry": "retrieve", "end": END})
#        ‚Üë
#        ‚îî‚îÄ‚îÄ ‚ú® –í–û–¢ –ó–î–ï–°–¨ –ú–ê–ì–ò–Ø: router(state) —Ä–µ—à–∞–µ—Ç, –∫—É–¥–∞ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ

app = workflow.compile()
result = app.invoke({"messages": [HumanMessage("...")]})
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç

```
‚ñ´Ô∏è –ü–æ–Ω–∏–º–∞—é: —Ü–µ–ø–æ—á–∫–∞ = –ª–∏–Ω–µ–π–Ω–∞—è, –≥—Ä–∞—Ñ = —Å –≤–µ—Ç–≤–ª–µ–Ω–∏—è–º–∏ –∏ —Ü–∏–∫–ª–∞–º–∏
‚ñ´Ô∏è –ó–Ω–∞—é: —É–∑–µ–ª –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç dict-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ state, –∞ –Ω–µ –≤–µ—Å—å state
‚ñ´Ô∏è –í–∏–∂—É: add_conditional_edges = router(state) ‚Üí –∫–ª—é—á ‚Üí –≤—ã–±–æ—Ä —É–∑–ª–∞
‚ñ´Ô∏è –ü–æ–º–Ω—é: —Ü–∏–∫–ª—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã recursion_limit
```

---

## üé¨ –°—Ç–æ—Ä–∏–±–æ—Ä–¥: –∫–∞–∫ ¬´—Ç–µ—á—ë—Ç¬ª –∑–∞–ø—Ä–æ—Å –ø–æ –≥—Ä–∞—Ñ—É LangGraph

–î–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å Excalidraw‚Äë–¥–∏–∞–≥—Ä–∞–º–º—É:

- —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–∏–Ω–µ–π–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ –∏ –≥—Ä–∞—Ñ–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π,
- State –∫–∞–∫ –æ–±—â–∞—è –ø–∞–º—è—Ç—å –¥–ª—è –≤—Å–µ—Ö —É–∑–ª–æ–≤,
- –∂—ë—Å—Ç–∫–∏–µ —Ä—ë–±—Ä–∞ (`add_edge`) –∏ —É—Å–ª–æ–≤–Ω—ã–µ (`add_conditional_edges`),
- retry‚Äë—Ü–∏–∫–ª –∏ —Ä–æ–ª—å `recursion_limit`,
- —Å–≤—è–∑—å LangGraph —Å RAG‚Äë–ø–∞–π–ø–ª–∞–π–Ω–æ–º.

–ì–æ—Ç–æ–≤—ã–π —Å—Ç–æ—Ä–∏–±–æ—Ä–¥ –ª–µ–∂–∏—Ç –≤ —Ñ–∞–π–ª–µ:

- [[10_module_cognitive_systems/03_langgraph/langgraph_flow_storyboard.excalidraw|–î–∏–∞–≥—Ä–∞–º–º–∞ –æ–±—Ö–æ–¥–∞ –≥—Ä–∞—Ñ–∞ LangGraph]]

---

## üìÅ –§–∞–π–ª—ã

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `01_langgraph_state_machines.ipynb` | StateGraph, —Ü–∏–∫–ª—ã, –≤–µ—Ç–≤–ª–µ–Ω–∏—è, –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ |
